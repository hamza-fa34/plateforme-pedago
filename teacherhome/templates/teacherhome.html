{% extends 'base.html' %}
{% load custom_filters %}
{% block title %}Espace Enseignant – Plateforme Pédagogique{% endblock %}

{% block content %}
<div class="dashboard-container">
  <!-- En-tête de page -->
  <header class="page-header">
    <h1>Accueil Enseignant</h1>
    <p class="welcome">Bonjour {{ user.first_name|default:user.username }}</p>
  </header>

  <div class="dashboard-main-content">
    <!-- Section Liste des ressources -->
    <section class="resources-table-section content-col">
      <header class="list-header">
        <h3><i class="fas fa-folder-open"></i> Mes ressources</h3>
      </header>
      <div class="resources-table-wrapper">
        <table class="table-fullwidth">
          <caption class="visually-hidden">Liste des ressources pédagogiques de l'enseignant</caption>
          <thead>
            <tr>
              <th scope="col">Titre</th>
              <th scope="col">Matière</th>
              <th scope="col">Niveau</th>
              <th scope="col">Type</th>
              <th scope="col">Nom du fichier</th>
              <th scope="col">Type fichier</th>
              <th scope="col">Permission</th>
              <th scope="col">Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for file_data in files_data %}
              <tr>
                <td data-label="Titre">{{ file_data.title }}</td>
                <td data-label="Matière">{{ file_data.subject }}</td>
                <td data-label="Niveau">{{ file_data.level }}</td>
                <td data-label="Type">{{ file_data.resource_type }}</td>
                <td data-label="Nom du fichier"><i class="fas fa-file-alt"></i> {{ file_data.file.name|get_file_name }}</td>
                <td data-label="Type fichier">
                  {% with ext=file_data.file.name|lower %}
                    {% if ext|slice:"-4:" == ".pdf" %}
                      <span class="badge badge-pdf">PDF</span>
                    {% elif ext|slice:"-4:" == ".doc" or ext|slice:"-5:" == ".docx" %}
                      <span class="badge badge-doc">DOC</span>
                    {% elif ext|slice:"-4:" == ".ppt" or ext|slice:"-5:" == ".pptx" %}
                      <span class="badge badge-ppt">PPT</span>
                    {% else %}
                      <span class="badge badge-other">AUTRE</span>
                    {% endif %}
                  {% endwith %}
                </td>
                <td data-label="Permission">
                  {% if file_data.permission == 1 %}
                    <span class="badge badge-public">Public</span>
                  {% else %}
                    <span class="badge badge-private">Privé</span>
                  {% endif %}
                </td>
                <td data-label="Actions">
                  <div class="action-buttons">
                    <a href="{% url 'download_file' file_data.id %}"
                       class="btn btn-sm btn-primary"
                       title="Télécharger"><i class="fas fa-download"></i></a>
                    <a href="{% url 'edit_resource' file_data.id %}"
                       class="btn btn-sm btn-warning"
                       title="Modifier"><i class="fas fa-edit"></i></a>
                    <form action="{% url 'delete_file' file_data.id %}"
                          method="post"
                          class="delete-form"
                          onsubmit="return confirm('Supprimer cette ressource ?')">
                      {% csrf_token %}
                      <button type="submit"
                              class="btn btn-sm btn-danger"
                              title="Supprimer"
                              aria-label="Supprimer {{ file_data.file.name|get_file_name }}">
                        <i class="fas fa-trash"></i>
                      </button>
                    </form>
                  </div>
                </td>
              </tr>
            {% empty %}
              <tr>
                <td colspan="8" class="text-center text-muted">Aucune ressource disponible.</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </section>

    <!-- Section Upload -->
    <aside class="upload-box">
      <h2 class="upload-title"><i class="fas fa-upload"></i> Ajouter une ressource</h2>
      <form method="post"
            action="{% url 'upload_form' %}"
            enctype="multipart/form-data"
            class="form upload-form">
        {% csrf_token %}
        <div class="form-group">
          <label for="{{ form.title.id_for_label }}">Titre</label>
          <input type="text"
                 name="{{ form.title.name }}"
                 id="{{ form.title.id_for_label }}"
                 class="form-control"
                 maxlength="255"
                 placeholder="Titre de la ressource">
        </div>
        <div class="form-group">
          <label for="{{ form.subject.id_for_label }}">Matière</label>
          <input type="text"
                 name="{{ form.subject.name }}"
                 id="{{ form.subject.id_for_label }}"
                 class="form-control"
                 maxlength="100"
                 placeholder="Matière (ex: Mathématiques)">
        </div>
        <div class="form-group">
          <label for="{{ form.level.id_for_label }}">Niveau</label>
          <input type="text"
                 name="{{ form.level.name }}"
                 id="{{ form.level.id_for_label }}"
                 class="form-control"
                 maxlength="100"
                 placeholder="Niveau (ex: Licence 1)">
        </div>
        <div class="form-group">
          <label for="{{ form.resource_type.id_for_label }}">Type</label>
          <input type="text"
                 name="{{ form.resource_type.name }}"
                 id="{{ form.resource_type.id_for_label }}"
                 class="form-control"
                 maxlength="50"
                 placeholder="Type (ex: Cours, TD, TP)">
        </div>
        <div class="form-group">
          <label for="{{ form.file.id_for_label }}">Fichier</label>
          <input type="file"
                 name="{{ form.file.name }}"
                 id="{{ form.file.id_for_label }}"
                 class="form-control"
                 accept=".pdf,.doc,.docx,.ppt,.pptx,.txt,.zip,.rar"
                 required>
        </div>
        <div class="form-group">
          <label for="{{ form.permission.id_for_label }}">Permission</label>
          <select name="{{ form.permission.name }}"
                  id="{{ form.permission.id_for_label }}"
                  class="form-control">
            <option value="1">Public</option>
            <option value="0">Privé</option>
          </select>
        </div>
        <button type="submit" class="btn btn-primary btn-upload">
          <i class="fas fa-upload"></i> Upload
        </button>
      </form>
    </aside>
  </div>
</div>
{% endblock %}
